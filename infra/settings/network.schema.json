{
    "$schema": "https://json-schema.org/draft-07/schema#",
    "$id": "https://schemas.azure.com/apim-accelerator/network-configuration/v1.0.0/network.schema.json",
    "title": "APIM Network Configuration Schema",
    "description": "JSON Schema for validating Azure API Management network infrastructure configuration including VNet, subnets, Azure Bastion, Azure Firewall, and DDoS protection settings.",
    "type": "object",
    "required": [
        "name",
        "description",
        "resourceGroup",
        "ipAddresses",
        "security"
    ],
    "additionalProperties": false,
    "properties": {
        "name": {
            "$ref": "#/definitions/azureResourceName",
            "title": "Virtual Network Name",
            "description": "Name of the virtual network. Must start and end with alphanumeric characters and can contain hyphens.",
            "examples": [
                "apim-virtual-network",
                "production-vnet",
                "dev-network-01"
            ]
        },
        "description": {
            "type": "string",
            "minLength": 10,
            "maxLength": 500,
            "title": "Configuration Description",
            "description": "Human-readable description of the network configuration and its purpose.",
            "examples": [
                "Configuration settings for the network infrastructure including VNet, subnets, Azure Bastion, Azure Firewall, and DDoS protection."
            ],
            "errorMessage": {
                "minLength": "Description must be at least 10 characters long",
                "maxLength": "Description must not exceed 500 characters"
            }
        },
        "resourceGroup": {
            "type": "object",
            "title": "Resource Group Configuration",
            "description": "Configuration for the Azure Resource Group that will contain the network resources.",
            "required": [
                "name"
            ],
            "additionalProperties": false,
            "properties": {
                "name": {
                    "$ref": "#/definitions/azureResourceGroupName",
                    "title": "Resource Group Name",
                    "description": "Name of the Azure Resource Group. Must follow Azure naming conventions.",
                    "examples": [
                        "apim-network-rg",
                        "prod-network-resources",
                        "dev-apim-rg"
                    ]
                }
            }
        },
        "ipAddresses": {
            "type": "object",
            "title": "IP Address Configuration",
            "description": "Configuration for virtual network address spaces and subnet definitions.",
            "required": [
                "addressSpaces",
                "subnets"
            ],
            "additionalProperties": false,
            "properties": {
                "addressSpaces": {
                    "type": "array",
                    "title": "Virtual Network Address Spaces",
                    "description": "List of CIDR blocks that define the virtual network address space.",
                    "minItems": 1,
                    "maxItems": 10,
                    "uniqueItems": true,
                    "items": {
                        "$ref": "#/definitions/cidrBlock",
                        "title": "CIDR Block",
                        "description": "IPv4 CIDR notation (e.g., 10.0.0.0/16, 192.168.1.0/24).",
                        "examples": [
                            "10.0.0.0/16",
                            "172.16.0.0/12",
                            "192.168.0.0/16"
                        ]
                    },
                    "errorMessage": {
                        "minItems": "At least one address space is required",
                        "maxItems": "No more than 10 address spaces are allowed",
                        "uniqueItems": "Address spaces must be unique"
                    }
                },
                "subnets": {
                    "type": "array",
                    "title": "Subnet Definitions",
                    "description": "List of subnets to be created within the virtual network.",
                    "minItems": 1,
                    "maxItems": 50,
                    "items": {
                        "type": "object",
                        "title": "Subnet Configuration",
                        "description": "Configuration for an individual subnet within the virtual network.",
                        "required": [
                            "name",
                            "addressPrefix"
                        ],
                        "additionalProperties": false,
                        "properties": {
                            "name": {
                                "$ref": "#/definitions/subnetName",
                                "title": "Subnet Name",
                                "description": "Name of the subnet. Must follow Azure naming conventions.",
                                "examples": [
                                    "AzureFirewallSubnet",
                                    "AzureBastionSubnet",
                                    "apim-subnet",
                                    "gateway-subnet"
                                ]
                            },
                            "addressPrefix": {
                                "$ref": "#/definitions/cidrBlock",
                                "title": "Subnet Address Prefix",
                                "description": "IPv4 CIDR notation for the subnet address space.",
                                "examples": [
                                    "10.0.1.0/24",
                                    "10.0.2.0/24",
                                    "192.168.1.0/26"
                                ]
                            }
                        }
                    },
                    "uniqueItems": true,
                    "errorMessage": {
                        "minItems": "At least one subnet is required",
                        "maxItems": "No more than 50 subnets are allowed",
                        "uniqueItems": "Subnet configurations must be unique"
                    }
                }
            }
        },
        "diagnostics": {
            "type": "object",
            "title": "Diagnostics Configuration",
            "description": "Configuration for network diagnostics and monitoring capabilities.",
            "required": [
                "enabled"
            ],
            "additionalProperties": false,
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "title": "Enable Diagnostics",
                    "description": "Whether to enable network diagnostics and monitoring features.",
                    "default": true
                }
            }
        },
        "security": {
            "type": "object",
            "title": "Security Configuration",
            "description": "Configuration for network security features and components.",
            "required": [
                "encryption"
            ],
            "additionalProperties": false,
            "properties": {
                "encryption": {
                    "type": "object",
                    "title": "Encryption Settings",
                    "description": "Configuration for network encryption features.",
                    "required": [
                        "enabled"
                    ],
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "title": "Enable Encryption",
                            "description": "Whether to enable virtual network encryption for enhanced security.",
                            "default": true
                        }
                    }
                },
                "azureBastion": {
                    "type": "object",
                    "title": "Azure Bastion Configuration",
                    "description": "Configuration for Azure Bastion host for secure RDP/SSH connectivity.",
                    "required": [
                        "enabled"
                    ],
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "title": "Enable Azure Bastion",
                            "description": "Whether to deploy Azure Bastion host.",
                            "default": false
                        },
                        "name": {
                            "$ref": "#/definitions/azureResourceName",
                            "title": "Bastion Host Name",
                            "description": "Name of the Azure Bastion host resource.",
                            "examples": [
                                "apim-bastion",
                                "prod-bastion-host",
                                "dev-bastion"
                            ]
                        },
                        "sku": {
                            "type": "string",
                            "enum": [
                                "Basic",
                                "Standard"
                            ],
                            "title": "Bastion SKU",
                            "description": "SKU tier for the Azure Bastion host.",
                            "default": "Basic"
                        },
                        "publicIPAddressName": {
                            "$ref": "#/definitions/publicIPName",
                            "title": "Public IP Address Name",
                            "description": "Name of the public IP address resource for the Bastion host.",
                            "examples": [
                                "bastion-public-ip",
                                "bastion-pip",
                                "apim-bastion-ip"
                            ]
                        },
                        "subnetName": {
                            "type": "string",
                            "pattern": "^AzureBastionSubnet$",
                            "title": "Bastion Subnet Name",
                            "description": "Name of the subnet for Azure Bastion. Must be 'AzureBastionSubnet'.",
                            "const": "AzureBastionSubnet"
                        }
                    },
                    "allOf": [
                        {
                            "if": {
                                "properties": {
                                    "enabled": {
                                        "const": true
                                    }
                                }
                            },
                            "then": {
                                "required": [
                                    "name",
                                    "sku",
                                    "publicIPAddressName",
                                    "subnetName"
                                ]
                            }
                        }
                    ]
                },
                "azureFirewall": {
                    "type": "object",
                    "title": "Azure Firewall Configuration",
                    "description": "Configuration for Azure Firewall for network security and traffic filtering.",
                    "required": [
                        "enabled"
                    ],
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "title": "Enable Azure Firewall",
                            "description": "Whether to deploy Azure Firewall.",
                            "default": false
                        },
                        "name": {
                            "$ref": "#/definitions/azureResourceName",
                            "title": "Firewall Name",
                            "description": "Name of the Azure Firewall resource.",
                            "examples": [
                                "apim-firewall",
                                "prod-firewall",
                                "network-firewall"
                            ]
                        },
                        "sku": {
                            "type": "string",
                            "enum": [
                                "AZFW_VNet",
                                "AZFW_Hub"
                            ],
                            "title": "Firewall SKU",
                            "description": "SKU name for the Azure Firewall.",
                            "default": "AZFW_VNet"
                        },
                        "tier": {
                            "type": "string",
                            "enum": [
                                "Standard",
                                "Premium",
                                "Basic"
                            ],
                            "title": "Firewall Tier",
                            "description": "Pricing tier for the Azure Firewall.",
                            "default": "Standard"
                        },
                        "subnetName": {
                            "type": "string",
                            "pattern": "^AzureFirewallSubnet$",
                            "title": "Firewall Subnet Name",
                            "description": "Name of the subnet for Azure Firewall. Must be 'AzureFirewallSubnet'.",
                            "const": "AzureFirewallSubnet"
                        },
                        "publicIPAddressName": {
                            "$ref": "#/definitions/publicIPName",
                            "title": "Public IP Address Name",
                            "description": "Name of the public IP address resource for the firewall.",
                            "examples": [
                                "firewall-public-ip",
                                "firewall-pip",
                                "apim-firewall-ip"
                            ]
                        }
                    },
                    "allOf": [
                        {
                            "if": {
                                "properties": {
                                    "enabled": {
                                        "const": true
                                    }
                                }
                            },
                            "then": {
                                "required": [
                                    "name",
                                    "sku",
                                    "tier",
                                    "subnetName",
                                    "publicIPAddressName"
                                ]
                            }
                        }
                    ]
                },
                "ddosProtection": {
                    "type": "object",
                    "title": "DDoS Protection Configuration",
                    "description": "Configuration for Azure DDoS Protection Standard plan.",
                    "required": [
                        "enabled"
                    ],
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "title": "Enable DDoS Protection",
                            "description": "Whether to enable Azure DDoS Protection Standard.",
                            "default": false
                        },
                        "name": {
                            "$ref": "#/definitions/azureResourceName",
                            "title": "DDoS Protection Plan Name",
                            "description": "Name of the DDoS Protection plan resource.",
                            "examples": [
                                "apim-ddos-plan",
                                "prod-ddos-protection",
                                "network-ddos-plan"
                            ]
                        }
                    },
                    "allOf": [
                        {
                            "if": {
                                "properties": {
                                    "enabled": {
                                        "const": true
                                    }
                                }
                            },
                            "then": {
                                "required": [
                                    "name"
                                ]
                            }
                        }
                    ]
                }
            }
        }
    },
    "examples": [
        {
            "name": "apim-virtual-network",
            "description": "Configuration settings for the network infrastructure including VNet, subnets, Azure Bastion, Azure Firewall, and DDoS protection.",
            "resourceGroup": {
                "name": "apim-network-rg"
            },
            "ipAddresses": {
                "addressSpaces": [
                    "10.0.0.0/16"
                ],
                "subnets": [
                    {
                        "name": "AzureFirewallSubnet",
                        "addressPrefix": "10.0.1.0/24"
                    },
                    {
                        "name": "AzureBastionSubnet",
                        "addressPrefix": "10.0.2.0/24"
                    }
                ]
            },
            "diagnostics": {
                "enabled": true
            },
            "security": {
                "encryption": {
                    "enabled": true
                },
                "azureBastion": {
                    "enabled": true,
                    "name": "apim-bastion",
                    "sku": "Basic",
                    "publicIPAddressName": "bastion-public-ip",
                    "subnetName": "AzureBastionSubnet"
                },
                "azureFirewall": {
                    "enabled": true,
                    "name": "apim-firewall",
                    "sku": "AZFW_VNet",
                    "tier": "Standard",
                    "subnetName": "AzureFirewallSubnet",
                    "publicIPAddressName": "firewall-public-ip"
                },
                "ddosProtection": {
                    "enabled": true,
                    "name": "apim-ddos-plan"
                }
            }
        }
    ],
    "definitions": {
        "azureResourceName": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$",
            "minLength": 2,
            "maxLength": 80,
            "description": "Standard Azure resource naming pattern. Must start and end with alphanumeric characters and can contain hyphens.",
            "errorMessage": {
                "pattern": "Resource name must start and end with alphanumeric characters and can only contain hyphens",
                "minLength": "Resource name must be at least 2 characters long",
                "maxLength": "Resource name must not exceed 80 characters"
            }
        },
        "azureResourceGroupName": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9][a-zA-Z0-9._()-]*[a-zA-Z0-9_)]$",
            "minLength": 1,
            "maxLength": 90,
            "description": "Azure resource group naming pattern. Can contain alphanumeric characters, periods, underscores, hyphens, and parentheses.",
            "errorMessage": {
                "pattern": "Resource group name can only contain alphanumeric characters, periods, underscores, hyphens, and parentheses",
                "minLength": "Resource group name must be at least 1 character long",
                "maxLength": "Resource group name must not exceed 90 characters"
            }
        },
        "cidrBlock": {
            "type": "string",
            "pattern": "^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\/(?:[0-9]|[1-2][0-9]|3[0-2])$",
            "description": "IPv4 CIDR notation (e.g., 10.0.0.0/16, 192.168.1.0/24)",
            "errorMessage": {
                "pattern": "Must be a valid IPv4 CIDR notation (e.g., 10.0.0.0/16)"
            }
        },
        "subnetName": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9][a-zA-Z0-9._-]*[a-zA-Z0-9]$",
            "minLength": 1,
            "maxLength": 80,
            "description": "Azure subnet naming pattern. Must follow Azure naming conventions.",
            "errorMessage": {
                "pattern": "Subnet name must start and end with alphanumeric characters and can contain periods, underscores, and hyphens",
                "minLength": "Subnet name must be at least 1 character long",
                "maxLength": "Subnet name must not exceed 80 characters"
            }
        },
        "publicIPName": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$",
            "minLength": 1,
            "maxLength": 80,
            "description": "Azure public IP address naming pattern",
            "errorMessage": {
                "pattern": "Public IP name must start and end with alphanumeric characters and can only contain hyphens",
                "minLength": "Public IP name must be at least 1 character long",
                "maxLength": "Public IP name must not exceed 80 characters"
            }
        },
        "enabledConfiguration": {
            "type": "object",
            "description": "Base configuration object with enabled flag",
            "required": [
                "enabled"
            ],
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "description": "Whether this feature is enabled"
                }
            }
        }
    }
}